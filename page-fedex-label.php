<?php@ob_start();if ( !session_id() )	session_start();/** * Template Name:Fedex Template  */get_header(); ?><div class="container">    <div class="row">        <div class="col-12"><?php     if(isset($_POST['genrate_label'])){        // session_start();        if(isset($_POST["captcha"])&&$_POST["captcha"]!=""&&$_SESSION["code"]==$_POST["captcha"])        {        // echo $_SESSION["code"]; exit;             unset($_SESSION['personename']);             unset($_SESSION['company']);             unset($_SESSION['address_1']);             unset($_SESSION['country']);             unset($_SESSION['city']);             unset($_SESSION['state']);             unset($_SESSION['post_code']);             unset($_SESSION['phone_number']);             unset($_SESSION['invalid']);                     $GLOBALS['host'] = "localhost";             $GLOBALS['username']  = "webstech_admin97";             $GLOBALS['password']  = "3UA1ASwTW?kh";             $GLOBALS['dbname']  = "webstech_wordpressslide";             $GLOBALS['personename']=$_POST['contact_name'];             $GLOBALS['company']=$_POST['company'];             $GLOBALS['address_1']=$_POST['address_1'];             $GLOBALS['country']=$_POST['country'];             $GLOBALS['city']=$_POST['city'];             $GLOBALS['state']=$_POST['state'];             $GLOBALS['post_code']=$_POST['post_code'];             $GLOBALS['phone_number']=$_POST['phone_number'];             function ExampleShipment(){                $strPath = "fedex/";                require_once $strPath.'fedex.settings.php';                require_once $strPath.'classes/class.fedex.php';                require_once $strPath.'classes/class.fedex.shipment.php';        //to create shipment labels                require_once $strPath.'classes/class.fedex.package.php';                $order_id = "123456";                $objShip = new fedexShipment();                $objShip->requestType("shipment");                $objShip->wsdl_root_path =$strPath."wsdl-test/";                $aryOrder = array(                                'TotalPackages' => 1,                                'PackageType' => 'YOUR_PACKAGING',        //FEDEX_10KG_BOX, FEDEX_25KG_BOX, FEDEX_BOX, FEDEX_ENVELOPE, FEDEX_PAK, FEDEX_TUBE, YOUR_PACKAGING                                'ServiceType' => 'FEDEX_2_DAY',                                'TermsOfSaleType' => "DDU",         #    DDU/DDP                                'DropoffType' => 'REGULAR_PICKUP'         // BUSINESS_SERVICE_CENTER, DROP_BOX, REGULAR_PICKUP, REQUEST_COURIER, STATION                );				 $objShip->wsdl_root_path = bloginfo('template_directory'). '/fedex/wsdl-test/';				                  $client = new SoapClient($objShip->wsdl_root_path . $objShip->wsdl_path, array('trace' => 1)); // Refer to http://us3.php.net/manual/en/ref.soap.php for more information                  $countrycode=$GLOBALS['country'];                 $countrycode=strtolower(str_replace(' ', '', $countrycode));                 if($countrycode=='usa' || $countrycode=='unitedstates' || $countrycode=='unitedstate')                 {                     $countrycode='US';                                     }                 else if ($countrycode=='canada')                 {                     $countrycode='CA';                 }                                $aryRecipient = array(                        'Contact' => array(                                'PersonName' => $GLOBALS['personename'],                                'CompanyName' => $GLOBALS['company'],                                'PhoneNumber' => $GLOBALS['phone_number']                        ),                        'Address' => array(                                'StreetLines' => array($GLOBALS['address_1']),                                'City' =>$GLOBALS['city'],                                'StateOrProvinceCode' =>$GLOBALS['state'],                                'PostalCode' => $GLOBALS['post_code'],                                'CountryCode' => $countrycode,                                'Residential' => false)                );                $realTotalPackages = 1;                $est_amount = 1100.00;                 $tracking_id = "";                $form_id = "";                for($main_loop = 0;$main_loop<$realTotalPackages;$main_loop++)                {                        $packages = array();                        $aryPackage = array();                                $package_amount = round($est_amount/$realTotalPackages,2);                        $item_amount = $package_amount/4;                                $package_weight = 50.0;                        $packages[0] = new Package("FEDEX Package # $main_loop for order ".$order_id, 1, 1);                        $packages[0]->setPackageWeight($package_weight);                        $packages[0]->setPackageDimensions(8, 7, 3);                        $aryPackage[0] = $packages[0]->getObjectArray();                                $item_weight = $package_weight/4;                                 $aryPackageItems = array();                        for($cnt=0;$cnt<1;$cnt++)                        {                            $aryPackageItems[$cnt]['item_qty'] = $cnt+10+1;                            $aryPackageItems[$cnt]['item_price'] = $item_amount;                            $aryPackageItems[$cnt]['item_name'] = "Item Name - ".($cnt+1)." of Package ".($main_loop+1);                            $aryPackageItems[$cnt]['item_weight'] = $item_weight;                        }                        $aryCustomClearance = $objShip->addCustomClearanceDetail($aryPackageItems, $package_amount);                                if($main_loop>0)                        {                                       $is_first_package['master_tracking_id'] = $tracking_id;                            $is_first_package['form_id'] = $form_id;                            $request = $objShip->requestShipment($aryRecipient, $aryOrder, $aryPackage, $aryCustomClearance, $is_first_package);                        }                        else                            $request = $objShip->requestShipment($aryRecipient, $aryOrder, $aryPackage, $aryCustomClearance);                                echo "<br /><br /><hr /><br /><br />";                                try                         {                            if ($objShip->setEndpoint('changeEndpoint'))                             {                                $newLocation = $client->__setLocation(setEndpoint('endpoint'));                            }                            $response = $client->processShipment($request); // FedEx web service invocation														               /* echo "<pre>";                                print_r($response);                                echo "</pre>";*/				                            if ($response->HighestSeverity != 'FAILURE' && $response->HighestSeverity != 'ERROR')                             {                                $success = $objShip->showResponseMessage($response);                                //                echo "<pre>";                //                print_r($response);                //                echo "</pre>";                                    // Create PNG or PDF label                                    // Set LabelSpecification.ImageType to 'PDF' for generating a PDF label                                                        $file_name = 'fedex-shipping_'.date('FjY_Gis').'_'.($main_loop+1).'.pdf';                                    $fp = fopen($file_name, 'wb');                                    fwrite($fp, ($response->CompletedShipmentDetail->CompletedPackageDetails->Label->Parts->Image));                                    fclose($fp);                                    echo 'Label '.$file_name.' was generated '.' <a class="fedex-print" href="' . blogino('url') . $file_name . '">Print</a>';                                                        echo '<br>';                                    //data for connecting                                    /*                                     * Store Master Tracking Number for First Package only                                     */                                    if($main_loop == 0)                                    {                                        $tracking_id = $response->CompletedShipmentDetail->CompletedPackageDetails->TrackingIds->TrackingNumber;                                        $form_id = $response->CompletedShipmentDetail->CompletedPackageDetails->TrackingIds->FormId;                                                            }                                                            }                             else                             {                               // echo "<pre>";                               // print_r($response);                               // echo "</pre>";                               // $error = $objRate->showResponseMessage($response);                                //echo $error;                            }                        }                         catch (SoapFault $exception)                         {						                            echo $objShip->requestError($exception, $client);                        }                }                // $conn = new mysqli($GLOBALS['host'], $GLOBALS['username'],  $GLOBALS['password'] ,$GLOBALS['dbname'] );                              /*        $insert_shipment = "insert into wp_shipment_detail (contact_name,company,address1,country_code,city,state,postal_code,phone_number)                                            values ('".$GLOBALS['personename']."','".$GLOBALS['company']."','".$GLOBALS['address_1']."','".$GLOBALS['country']."'                                            ,'".$GLOBALS['city']."','".$GLOBALS['state']."','".$GLOBALS['post_code']."','".$GLOBALS['phone_number']."')";                                                                                    if($conn->query($insert_shipment) === TRUE)                                            {*/                                               CreatePickup($aryRecipient);                                            //}         }        ?><?php            function CreatePickup($customerPostedData = array() ){                $strPath = "fedex/";                require_once $strPath.'classes/class.fedex.pickup.php';                $error_msg = "";                $str_selected_orders = "";                    $pickup_id = "";                       $aryPickup['PickupName'] = "Pick up";                $aryPickup['PackageCount'] = 1;                $aryPickup['TotalWeight'] = 14;                $aryPickup['CourierRemarks'] = "No Remarks";                $aryPickup['CarrierCode'] = "FDXE";     #FDXE/FDXG                $aryPickup['BuildingPartCode'] = "CBoard456";                $aryPickup['PackageLocation'] = "Front";        #Front/None/Side/Rare                $aryPickup['BuildingPartDescription'] = "Industrial Circuit Board Repair";                $aryPickup['CompanyCloseTime'] = "23:37:46";				$date = date("Y-m-d h:i:s");				$time = strtotime($date);				$time = $time + (1200 * 60);				$date = date("Y-m-d 02:00:00", $time);							//	echo '<br>'.$date;                $aryPickup['ReadyTimestamp'] = $date;/*echo "<pre>";                        print_r($aryPickup);                        echo "</pre>";					exit;*/					                $objPickup = new fedexPickup();                $objPickup->requestType("pickup");	                $objPickup->wsdl_root_path =$strPath."wsdl-test/";												 $objPickup->wsdl_root_path =  bloginfo('url') . '/fedex/wsdl-test/';				 				// echo $objPickup->wsdl_root_path.$objPickup->wsdl_path;				                 $client = new SoapClient($objPickup->wsdl_root_path.$objPickup->wsdl_path, array('trace' => 1));                $request = $objPickup->pickupRequest($aryPickup);				if( $customerPostedData && count($customerPostedData) > 0 ) {					unset($request['OriginDetail']['PickupLocation']);					$request['OriginDetail']['PickupLocation'] = $customerPostedData;								}				$hr =  date('h');				$request['PickupRequestType'] = array('SAME_DAY', 'FUTURE_DAY');				if($hr >= 1 && $hr <=4)			 	 $request['OriginDetail']['ReadyTimestamp'] = date('c', strtotime('+12 hours')) ; //date("Y-m-d").'T12:00:00'; // date('c'); // gmmktime(); //strtotime('+0 days');				/*echo "<pre>";                        print_r($request);                        echo "</pre>";					exit;	*/                try                 {                    if ($objPickup->setEndpoint('changeEndpoint'))                     {                        $newLocation = $client->__setLocation(setEndpoint('endpoint'));                    }                    $response = $client->createPickup($request);				//	print_r($response);                    if ($response->HighestSeverity != 'FAILURE' && $response->HighestSeverity != 'ERROR')                     {                           //success                        //echo "<pre>";                        //print_r($response);                        //echo "</pre>";                    }                     else                     {                        echo $objPickup->showResponseMessage($response);                        echo "<pre>";                     //   print_r($response);                        echo "</pre>";                    }                }                 catch (SoapFault $exception)                 {                    echo $objPickup->requestError($exception, $client);                   // echo "<pre>";                   // print_r($response);                    //echo "</pre>";                }            }            ExampleShipment();        }        else        {            $_SESSION['personename']=$_POST['contact_name'];            $_SESSION['company']=$_POST['company'];            $_SESSION['address_1']=$_POST['address_1'];            $_SESSION['country']=$_POST['country'];            $_SESSION['city']=$_POST['city'];            $_SESSION['state']=$_POST['state'];            $_SESSION['post_code']=$_POST['post_code'];            $_SESSION['phone_number']=$_POST['phone_number'];            $_SESSION['invalid']=TRUE;                        header('location:' . bloginfo('url') . '/fedex-label/');        }    }?><?php  if(!isset($_POST['genrate_label'])){?><div class="fedex-label"><h1 class="text-info">Free Fedex Shipping Label</h1><p class="lead border-bottom pb-3 mb-3">Please complete the form below and click the "Generate Label" button. When the label displays, click the "print label" button. A pick-up will automatically be scheduled. If you are shipping from outside the United States, please call <a href="tel:18008619773" title="Call 1-800-861-9773">1-800-861-9773</a> to make special arrangements.</p>	<div class="card mb-5">		<div class="card-header">			<h2 class="text-primary">Return Shipper Information</h2>			<div class="text-muted"><span class="text-danger">* </span> Denotes Required Field</div>			</div>			     	<div class="fedex-form card-body">     		<form action="" method="post" name="classic">			<div class="container">				<?php session_start(); ?>				<div class="row row-flex align-items-center">					<div class="col-auto p-1">						<label class="mb-0"  for "name"><span class="text-danger">* </span>Contact Name</label>					</div>					<div class="col p-1">						<input type="text"  name="contact_name" value="<?php if(isset($_SESSION['personename'])){ echo $_SESSION['personename']; }?>"  required>					</div>				</div>				<div class="row row-flex align-items-center">					<div class="col-auto p-1">						<label class="mb-0"  for "company">Company</label>					</div>					<div class="col p-1">						<input type="text" name="company" value="<?php if(isset($_SESSION['company'])){ echo $_SESSION['company']; }?>">					</div>				</div>				<div class="row row-flex align-items-center ">					<div class="col-auto p-1">						<label class="mb-0"  for "address"><span class="text-danger">* </span>Street Address</label>					</div>					<div class="col p-1">						<input type="text" name="address_1" value="<?php if(isset($_SESSION['address_1'])){ echo $_SESSION['address_1']; }?>" required>					</div>				</div>				<div class="row row-flex align-items-center ">					<div class="col-auto p-1">						<label class="mb-0"  for "city"><span class="text-danger">* </span>City</label>					</div>					<div class="col p-1">						<input type="text" name="city" value="<?php if(isset($_SESSION['city'])){ echo $_SESSION['city']; }?>" required>					</div>				</div>				<div class="row row-flex align-items-center ">					<div class="col-auto p-1">						<label class="mb-0"  for "state"><span class="text-danger">* </span>State</label>					</div>					<div class="col p-1 ginput_container_select">						<select class="border" name="state" required><?php echo customStateDropdown($_SESSION['state'], 'mixed'); ?><option value="" disabled selected>Select a State</option></select>					</div>				</div>		      				<div class="row row-flex align-items-center ">					<div class="col-auto p-1">						<label class="mb-0"  for "zip"><span class="text-danger">* </span>Zip Code</label>					</div>					<div class="col p-1">						<input type="text" name="post_code" value="<?php if(isset($_SESSION['post_code'])){ echo $_SESSION['post_code']; }?>" required>					</div>				</div>				<div class="row row-flex align-items-center ">					<div class="col-auto p-1">						<label class="mb-0"  for "country"><span class="text-danger">* </span>Country</label>					</div>					<div class="col p-1 ginput_container_select">						<select name="country" required><option value="usa">United States</option></select>					</div>				</div>				<div class="row row-flex align-items-center ">					<div class="col-auto p-1">						<label class="mb-0"  for "phone"><span class="text-danger">* </span>Phone Number</label>					</div>					<div class="col p-1">						<input type="text" name="phone_number" value="<?php if(isset($_SESSION['phone_number'])){ echo $_SESSION['phone_number']; }?>" required>					</div>				</div>				<div class="row row-flex align-items-center  my-3 py-3 border-top border-bottom">					<div class="col-12 p-1">						<label class="mb-0" for "name">Please type the numbers from the blue box in the text field to confirm you're a human.</label>					</div>					<div class="col-auto p-1">						<div class="fedex-captcha"><img src="<?php echo get_template_directory_uri();?>/fedex/modules/shipment/captcha.php" /></div>					</div>					<div class="col p-1">						<input name="captcha" type="text">						<div class="text-danger"><?php if(isset($_SESSION['invalid'])){ echo 'Please Enter the Correct Captcha';  }?></div>					</div>				</div>							</div>		</form>			      </div>		<div class="card-footer">											<div class="fedex-submit"><input type="submit" class="btn btn-info btn-lg my-3" name="genrate_label" value="Generate Label"></div>								</div>	</div><?php } ?><!-- #content --></div><!-- #primary -->		</div>	</div></div><?php get_footer(); ?><?php function customStateDropdown($post=null, $type='abbrev') {	$states = array(		array('AK', 'Alaska'),		array('AL', 'Alabama'),		array('AR', 'Arkansas'),		array('AZ', 'Arizona'),		array('CA', 'California'),		array('CO', 'Colorado'),		array('CT', 'Connecticut'),		array('DC', 'District of Columbia'),		array('DE', 'Delaware'),		array('FL', 'Florida'),		array('GA', 'Georgia'),		array('HI', 'Hawaii'),		array('IA', 'Iowa'),		array('ID', 'Idaho'),		array('IL', 'Illinois'),		array('IN', 'Indiana'),		array('KS', 'Kansas'),		array('KY', 'Kentucky'),		array('LA', 'Louisiana'),		array('MA', 'Massachusetts'),		array('MD', 'Maryland'),		array('ME', 'Maine'),		array('MI', 'Michigan'),		array('MN', 'Minnesota'),		array('MO', 'Missouri'),		array('MS', 'Mississippi'),		array('MT', 'Montana'),		array('NC', 'North Carolina'),		array('ND', 'North Dakota'),		array('NE', 'Nebraska'),		array('NH', 'New Hampshire'),		array('NJ', 'New Jersey'),		array('NM', 'New Mexico'),		array('NV', 'Nevada'),		array('NY', 'New York'),		array('OH', 'Ohio'),		array('OK', 'Oklahoma'),		array('OR', 'Oregon'),		array('PA', 'Pennsylvania'),		array('PR', 'Puerto Rico'),		array('RI', 'Rhode Island'),		array('SC', 'South Carolina'),		array('SD', 'South Dakota'),		array('TN', 'Tennessee'),		array('TX', 'Texas'),		array('UT', 'Utah'),		array('VA', 'Virginia'),		array('VT', 'Vermont'),		array('WA', 'Washington'),		array('WI', 'Wisconsin'),		array('WV', 'West Virginia'),		array('WY', 'Wyoming')	);		$options = '<option value=""></option>';		foreach ($states as $state) {		if ($type == 'abbrev') {    	$options .= '<option value="'.$state[0].'" '. custom_check_selectdrp($post, $state[0], false) .' >'.$state[0].'</option>'."\n";    } elseif($type == 'name') {    	$options .= '<option value="'.$state[1].'" '. custom_check_selectdrp($post, $state[1], false) .' >'.$state[1].'</option>'."\n";    } elseif($type == 'mixed') {    	$options .= '<option value="'.$state[0].'" '. custom_check_selectdrp($post, $state[0], false) .' >'.$state[1].'</option>'."\n";    }	}			echo $options;}/** * Check Select Element  * * @param string $i, POST value * @param string $m, input element's value * @param string $e, return=false, echo=true  * @return string  */function custom_check_selectdrp($i,$m,$e=true) {	if ($i != null) { 		if ( $i == $m ) { 			$var = ' selected="selected" '; 		} else {			$var = '';		}	} else {		$var = '';		}	if(!$e) {		return $var;	} else {		echo $var;	}}     ?>